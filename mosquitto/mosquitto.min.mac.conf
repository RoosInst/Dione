# Config file for mosquitto version 2.0.14 for Dione 2/9/2022 & rtalk 7/5/21
# mqtt 1883, wss 8883
# Secure websocket, minified, mac default brew paths, logging enabled, allow anon and 'rtalk'
#
# Setup Instructions
# install mosquitto with "brew install mosquitto" command
# run "./setup-mosquitto-dione.sh" (copies .conf, .pem, .key, pwdfile.rtalk to /usr/local/etc/mosquitto)
# -or- paste the contents below into (brew --prefix)/etc/mosquitto/mosquitto.conf
# -or- cp mosquitto.min.mac.conf /usr/local/etc/mosquitto/mosquitto.conf

# =================================================================
# General configuration
# =================================================================

# Max QoS 1 and 2 messages currently inflight per client.
# Defaults to 20. Set to 0 for no maximum.
max_inflight_messages 0

# Max QoS 1 and 2 messages to hold in a queue per client
# Defaults to 1000. Set to 0 for no maximum (not recommended).
max_queued_messages 0

# The default if not set is to never expire persistent clients.
persistent_client_expiration 12h

# RI REQUIRED FOR PERFORMANCE
# Disable Nagle's algorithm on client sockets. This has the effect of reducing
# latency of individual messages at the potential cost of increasing the number
# of packets being sent.
set_tcp_nodelay true

# =================================================================
# Listeners
# =================================================================

# listener port-number [ip address/host name/unix socket path]
listener 1883
protocol mqtt
# note: SSL only enabled for websockets... enable for SSL over 1883 
#certfile  /usr/local/etc/mosquitto/dione-mosquitto.pem
#keyfile   /usr/local/etc/mosquitto/dione-mosquitto.key

# websockets
listener 8883
protocol websockets

# Optional when a listener is using the websockets protocol, it is possible to serve over http
#http_dir

# -----------------------------------------------------------------
# WSS Certificate based SSL/TLS support
# -----------------------------------------------------------------
# Both of certfile and keyfile must be defined to enable certificate based
# TLS encryption.

# Path to the PEM encoded server certificate.
certfile  /usr/local/etc/mosquitto/dione-mosquitto.pem

# Path to the PEM encoded keyfile.
keyfile   /usr/local/etc/mosquitto/dione-mosquitto.key

# =================================================================
# Logging
# =================================================================
# Possible destinations are: stdout stderr syslog topic file dlt
# stdout and stderr log to the console on the named output.

# topic logs to the broker topic '$SYS/broker/log/<severity>',
# where severity is one of D, E, W, N, I, M which are debug, error,
# warning, notice, information and message. Message type severity is used by
# the subscribe/unsubscribe log_types and publishes log messages to
# $SYS/broker/log/M/susbcribe or $SYS/broker/log/M/unsubscribe.
#
# Use "log_dest none" if you wish to disable logging.
log_dest stdout
log_dest topic
log_dest file /Users/rbenech/mosquitto.log

# Types of messages to log. Use multiple log_type lines for logging
# multiple types of messages.
# Possible types are: debug, error, warning, notice, information,
# none, subscribe, unsubscribe, websockets, all.
# Note that debug type messages are for decoding the incoming/outgoing
# network packets. They are not logged in "topics".
log_type error
log_type warning
log_type notice
log_type information
log_type websockets

# If set to true, client connection and disconnection messages will be included
# in the log.
connection_messages true

# If set to true, add a timestamp value to each log message.
log_timestamp true

# Change the websockets logging integer that is interpreted by
# libwebsockets as a bit mask for its lws_log_levels enum.
# The err / warn / notice default is 0000 0111, so int 7... 
# https://stackoverflow.com/questions/42535181/how-to-enable-debug-logging-with-libwebsockets
websockets_log_level 7

# =================================================================
# Security
# =================================================================

# Boolean value that determines whether clients that connect
# without providing a username are allowed to connect.
# Change to false in production
allow_anonymous true

# -----------------------------------------------------------------
# Default authentication and topic access control
# -----------------------------------------------------------------

# Rtalk user with TLS encoded password
password_file /usr/local/etc/mosquitto/pwdfile.rtalk